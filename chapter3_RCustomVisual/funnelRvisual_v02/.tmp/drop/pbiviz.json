{"visual":{"name":"funnelRvisualVer02","displayName":"funnelRvisualVer02","guid":"funnelRvisualVer02","visualClassName":"Visual","version":"1.0.2","description":"","supportUrl":"","gitHubUrl":""},"apiVersion":"1.7.0","author":{"name":"","email":""},"assets":{"icon":"assets/icon.png"},"externalJS":["node_modules/powerbi-visuals-utils-dataviewutils/lib/index.js"],"style":"style/visual.less","capabilities":{"dataRoles":[{"displayName":"Population","description":"Numeric variable (positive integer)","kind":"GroupingOrMeasure","name":"population"},{"displayName":"Occurrence","description":"Numeric variable (nonnegative integer). Must be smaller than 'Population'","kind":"GroupingOrMeasure","name":"occurrence"},{"displayName":"Tooltips","description":"Fields to be used as mouseover tooltips","kind":"Grouping","name":"tooltips"}],"dataViewMappings":[{"conditions":[{"population":{"max":1},"occurrence":{"max":1},"tooltips":{"max":7}}],"scriptResult":{"dataInput":{"table":{"rows":{"select":[{"for":{"in":"population"}},{"for":{"in":"occurrence"}},{"for":{"in":"tooltips"}}],"dataReductionAlgorithm":{"top":{}}}}},"script":{"scriptProviderDefault":"R","scriptOutputType":"png","source":{"objectName":"rcv_script","propertyName":"source"},"provider":{"objectName":"rcv_script","propertyName":"provider"},"scriptSourceDefault":"# Copyright (c) Microsoft Corporation.  All rights reserved.\r\n\r\n# Third Party Programs. This software enables you to obtain software applications from other sources. \r\n# Those applications are offered and distributed by third parties under their own license terms.\r\n# Microsoft is not developing, distributing or licensing those applications to you, but instead, \r\n# as a convenience, enables you to use this software to obtain those applications directly from \r\n# the application providers.\r\n# By using the software, you acknowledge and agree that you are obtaining the applications directly\r\n# from the third party providers and under separate license terms, and that it is your responsibility to locate, \r\n# understand and comply with those license terms.\r\n# Microsoft grants you no license rights for third-party software or applications that is obtained using this software.\r\n\r\n# See also:\r\n# http://stats.stackexchange.com/questions/5195/how-to-draw-funnel-plot-using-ggplot2-in-r/5210#5210\r\n\r\n\r\n#DEBUG in RStudio\r\nfileRda = \"C:/Users/boefraty/projects/PBI/R/tempData.Rda\"\r\nif(file.exists(dirname(fileRda)))\r\n{\r\n  if(Sys.getenv(\"RSTUDIO\")!=\"\")\r\n    load(file= fileRda)\r\n  else\r\n    save(list = ls(all.names = TRUE), file=fileRda)\r\n}\r\n\r\n###############Library Declarations###############\r\n\r\nlibraryRequireInstall = function(packageName, ...)\r\n{\r\n  if(!require(packageName, character.only = TRUE)) \r\n    warning(paste(\"*** The package: '\", packageName, \"' was not installed ***\", sep=\"\"))\r\n}\r\n\r\n\r\nlibraryRequireInstall(\"ggplot2\")\r\nlibraryRequireInstall(\"scales\")\r\n\r\n\r\n###############Internal parameters definitions#################\r\n# Set of parameters, which are not exported to GUI\r\n\r\n\r\n##PBI_PARAM Color of scatterplot points\r\n#Type:string, Default:\"orange\", Range:NA, PossibleValues:\"orange\",\"blue\",\"green\",\"black\"\r\npointsCol = \"orange\"\r\n\r\n#PBI_PARAM Transparency of scatterplot points\r\n#Type:numeric, Default:0.4, Range:[0,1], PossibleValues:NA, Remarks: NA\r\ntransparency = 0.4\r\n\r\n##PBI_PARAM Color of baseline\r\n#Type:string, Default:\"blue\", Range:NA, PossibleValues:\"orange\",\"blue\",\"green\",\"black\"\r\nlineColor = \"blue\"\r\n\r\n\r\n#PBI_PARAM Sparsification of scatterplot points\r\n#Type:bool, Default:TRUE, Range:NA, PossibleValues:NA, Remarks: NA\r\nsparsify = TRUE\r\n\r\n#PBI_PARAM Size of points on the plot\r\n#Type:numeric, Default: 1 , Range:[0.1,5], PossibleValues:NA, Remarks: NA\r\npointCex = 1\r\n\r\n\r\n#PBI_PARAM Confidence level line\r\n#Type:numeric, Default: 0.75 , Range:[0,1], PossibleValues:NA, Remarks: GUI input is predefined set of values\r\nconf1 = 0.95\r\n\r\n#PBI_PARAM Confidence level line #2\r\n#Type:numeric, Default: 0.95 , Range:[0,1], PossibleValues:NA, Remarks: NA\r\nconf2 = 0.99\r\n\r\n##PBI_PARAM Precentage or Ratio ?\r\n#Type:bool, Default:TRUE, Range:NA, PossibleValues:NA\r\naxisXisPercentage = TRUE # ratio or percentage\r\n\r\n##PBI_PARAM Axis X format\r\n#Type:string, Default:\"comma\", Range:NA, PossibleValues:\"none\",\"comma\",\"scientific\",\"dollar\"\r\nscaleXformat = \"comma\"\r\n\r\n##PBI_PARAM Axis Y format\r\n#Type:string, Default:\"none\", Range:NA, PossibleValues:\"none\",\"comma\",\"scientific\"\r\nscaleYformat = \"none\"\r\n\r\n#PBI_PARAM Size of labels on axes\r\nsizeLabel = 12\r\n\r\n#PBI_PARAM Size of ticks on axes\r\nsizeTicks = 6\r\n\r\n#PBI_PARAM Size of labels on axes\r\ncolLabel = \"gray\"\r\n\r\n#PBI_PARAM is vertical plot\r\nverticalPlot = FALSE\r\n\r\n#PBI_PARAM Minimal number of points for funnel plot\r\nminPoints = 10\r\n\r\n#PBI_PARAM Size of warnings font\r\nsizeWarn = 11\r\n\r\n\r\n###############Internal functions definitions#################\r\n# Functions, used only for this visual \r\n\r\n\r\n# Post-process text string to show on plot\r\n# if very very long abbreviate\r\n# if looooooong convert to lo...\r\n# if shorter than maxChar remove \r\ncutStr2Show = function(strText, strCex = 0.8, abbrTo = 100, isH = TRUE, maxChar = 3, partAvailable = 1)\r\n{\r\n  # partAvailable, wich portion of window is available, in [0,1]\r\n  if(is.null(strText))\r\n    return (NULL)\r\n  \r\n  SCL = 0.075*strCex/0.8\r\n  pardin = par()$din\r\n  gStand = partAvailable*(isH*pardin[1]+(1-isH)*pardin[2]) /SCL\r\n  \r\n  # if very very long abbreviate\r\n  if(nchar(strText)>abbrTo && nchar(strText)> 1)\r\n    strText = abbreviate(strText, abbrTo)\r\n  \r\n  # if looooooong convert to lo...\r\n  if(nchar(strText)>round(gStand) && nchar(strText)> 1)\r\n    strText = paste(substring(strText,1,floor(gStand)),\"...\",sep=\"\")\r\n  \r\n  # if shorter than maxChar remove \r\n  if(gStand<=maxChar)\r\n    strText = NULL\r\n  \r\n  return(strText) \r\n}\r\n\r\n\r\n#randomly remove points from scatter if too many \r\nSparsifyScatter = function (xyDataFrame, numXstrips = 9, numYstrips = 7, minMaxPoints = c(3000,9000), minmaxInStrip =  c(900,9000), maxInCell = 300, remDuplicated = TRUE)\r\n{\r\n  \r\n  N_big = N = nrow(xyDataFrame)\r\n  usePoints = rep(TRUE,N)\r\n  \r\n  if(N <= minMaxPoints[1]) # do nothing\r\n    return (usePoints)\r\n  \r\n  if(remDuplicated) # remove duplicated\r\n  {\r\n    usePoints = usePoints & (!duplicated(xyDataFrame))\r\n    N = sum(usePoints)\r\n  }\r\n  \r\n  if(N <= minMaxPoints[1]) # do nothing\r\n    return (usePoints)\r\n  \r\n  rangeX = range(xyDataFrame[,1])\r\n  rangeY = range(xyDataFrame[,2])\r\n  \r\n  gridX = seq(rangeX[1],rangeX[2], length.out = numXstrips + 1)\r\n  gridY = seq(rangeY[1],rangeY[2], length.out = numYstrips + 1)\r\n  \r\n  #go cell by cell and sparsify \r\n  for (iX in seq(1,numXstrips))\r\n  {\r\n    smallRangeX = c(gridX[iX],gridX[iX+1])\r\n    inStrip = xyDataFrame[,1]>= smallRangeX[1] & xyDataFrame[,1]<= smallRangeX[2] &  usePoints\r\n    if(sum(inStrip) > minmaxInStrip[1])\r\n      for (iY in seq(1,numYstrips))\r\n      {\r\n        smallRangeY = c(gridY[iY],gridY[iY+1])\r\n        inCell = xyDataFrame[,2]>= smallRangeY[1] & xyDataFrame[,2]<= smallRangeY[2] &  inStrip\r\n        if(sum(inCell) > maxInCell)\r\n        {\r\n          inCellIndexes = seq(1,N_big)[inCell]\r\n          #randomly select maxInCell out of inCellIndexes\r\n          iii = sample(inCellIndexes,size = sum(inCell) - maxInCell, replace = FALSE)\r\n          usePoints[iii] = FALSE\r\n        }\r\n      }\r\n    \r\n  }\r\n  N = sum(usePoints)\r\n  \r\n  #if by the end still too many points --> go on whole set  \r\n  if(N > minMaxPoints[2])\r\n  {\r\n    inIndexes = seq(1,N_big)[usePoints]\r\n    #randomly select minMaxPoints[2] out of inIndexes\r\n    iii = sample(inIndexes,size = minMaxPoints[2], replace = FALSE)\r\n    usePoints[-iii] = FALSE\r\n  }\r\n  return (usePoints)\r\n}\r\n\r\n# return FALSE if canvas is too small\r\ngoodPlotDimension = function(minWidthInch = 3,minHeightInch = 2.2)\r\n{\r\n  re = (par()$din[1] > minWidthInch) & (par()$din[2] > minHeightInch)\r\n  return(re)\r\n}\r\n\r\n#tweak the limits of the axis\r\nNiceLimitsAxis <- function(axisData, baseline =NULL, isPositive = TRUE)\r\n{\r\n  limsA = c(min(axisData), max(axisData)) # default\r\n  if(is.null(baseline))\r\n    baseline = sum(limsA)/2\r\n  \r\n  limsA = (limsA - mean(limsA))*1.3 + baseline # centralize\r\n  limsA[1] = min(limsA[1],min(axisData)) # include outliers\r\n  limsA[2] = max(limsA[2],max(axisData)) # include outliers\r\n  if(limsA[1] < 0 && isPositive) # don't include region far away from 0\r\n  { \r\n    temp = -0.02 * (limsA[2])\r\n    limsA[1] = max(temp, limsA[1]) \r\n  }\r\n  return(limsA)\r\n}\r\n\r\n\r\n############# Input validation & initializations ############# \r\n\r\nif(conf2 < conf1)# swap\r\n{   temp = conf1; conf1 = conf2; conf2 = temp}\r\n\r\nvalidToPlot = TRUE\r\n\r\npbiWarning = \"\"\r\n\r\ngpd = goodPlotDimension()\r\n\r\nif(validToPlot && !gpd) # too small canvas\r\n{\r\n  validToPlot = FALSE\r\n  pbiWarning1 = \"Visual is \"\r\n  pbiWarning1 = cutStr2Show(pbiWarning1, strCex = sizeWarn/6, partAvailable = 0.9)\r\n  pbiWarning2 = \"too small \"\r\n  pbiWarning2 = cutStr2Show(pbiWarning2, strCex = sizeWarn/6, partAvailable = 0.9)\r\n  pbiWarning<-paste(pbiWarning1, \"<br>\", pbiWarning2, sep=\"\")\r\n  sizeWarn = 8 #smaller \r\n}\r\n\r\n\r\n#RVIZ_IN_PBI_GUIDE:BEGIN:Removed to enable custom visual fields \r\n# if(validToPlot && (ncol(dataset)< 2)) # invalid input \r\n# {\r\n#   validToPlot = FALSE\r\n#   pbiWarning1 = \"Both population and occurrence are required\"\r\n#   pbiWarning = cutStr2Show(pbiWarning1, strCex = sizeWarn/6, partAvailable = 0.9)\r\n# }\r\n\r\n# if(validToPlot)\r\n#   validData = complete.cases(dataset) & (dataset[,1]>=dataset[,2])\r\n#RVIZ_IN_PBI_GUIDE:END:Removed to enable custom visual fields\r\n\r\n#RVIZ_IN_PBI_GUIDE:BEGIN:Added to enable custom visual fields \r\nif(validToPlot && (!exists(\"population\") ||!exists(\"occurrence\"))) # invalid input \r\n{\r\n  validToPlot = FALSE\r\n  pbiWarning1 = \"Both population and occurrence are required\"\r\n  pbiWarning = cutStr2Show(pbiWarning1, strCex = sizeWarn/6, partAvailable = 0.9)\r\n}\r\n\r\nif(validToPlot)\r\n{# take care of NaN and NULL values \r\n  population[is.na(population)] = 0\r\n  occurrence[is.na(occurrence)] = -1\r\n  population[is.null(population)] = 0\r\n  occurrence[is.null(occurrence)] = -1\r\n  \r\n  #clean data\r\n  validData = rep(TRUE,nrow(population))\r\n  validData = as.logical(validData & (population > 1) & (occurrence >= 0)  & (occurrence <= population ))\r\n}\r\n\r\nif(validToPlot && (sum(validData) < minPoints)) # not enough data samples\r\n{\r\n  validToPlot = FALSE\r\n  pbiWarning1 = \"Not enough data samples\"\r\n  pbiWarning1 = cutStr2Show(pbiWarning1, strCex = sizeWarn/6, partAvailable = 0.9)\r\n  pbiWarning2 = \"for funnel plot\"\r\n  pbiWarning2 = cutStr2Show(pbiWarning2, strCex = sizeWarn/6, partAvailable = 0.9)\r\n  pbiWarning<-paste(pbiWarning1, \"<br>\", pbiWarning2, sep=\"\")\r\n}\r\n#RVIZ_IN_PBI_GUIDE:END:Added to enable custom visual fields \r\n\r\n\r\n\r\nif(validToPlot && (sum(validData) < minPoints)) # not enough data samples\r\n{\r\n  validToPlot = FALSE\r\n  pbiWarning1 = \"Not enough VALID data samples\"\r\n  pbiWarning1 = cutStr2Show(pbiWarning1, strCex = sizeWarn/6, partAvailable = 0.9)\r\n  pbiWarning2 = \"for funnel plot\"\r\n  pbiWarning2 = cutStr2Show(pbiWarning2, strCex = sizeWarn/6, partAvailable = 0.9)\r\n  pbiWarning<-paste(pbiWarning1, \"\\n\", pbiWarning2, sep=\"\")\r\n}\r\n\r\n\r\n############# Main code #####################\r\n\r\nif(validToPlot)\r\n{\r\n  #RVIZ_IN_PBI_GUIDE:BEGIN:Added to enable custom visual fields   \r\n  if(!exists(\"tooltips\"))\r\n  {\r\n    dataset = cbind(population,occurrence)\r\n  }else{\r\n    dataset = cbind(population,occurrence,tooltips)\r\n  }\r\n  #RVIZ_IN_PBI_GUIDE:END:Added to enable custom visual fields\r\n  \r\n  dataset = dataset[validData,]# keep only valid\r\n  namesDS = names(dataset)\r\n  \r\n  countValue = dataset[,1]\r\n  p = dataset[,2]/dataset[,1]\r\n  p.se <- sqrt((p*(1-p)) / (countValue))\r\n  df <- data.frame(p, countValue, p.se)\r\n  \r\n  ## common effect (fixed effect model)\r\n  p.fem <- weighted.mean(p[p.se>0], 1/p.se[p.se>0]^2)\r\n  \r\n  ## lower and upper limits, based on FEM estimator\r\n  zLow = qnorm(conf1)\r\n  zUp = qnorm(conf2)\r\n  \r\n  if(axisXisPercentage)\r\n  {\r\n    mult = 100\r\n    entryWordLabelY = \"Percentage of \"\r\n  }\r\n  else\r\n  {\r\n    mult = 1\r\n    entryWordLabelY = \"Ratio of \"\r\n  }\r\n  \r\n  number.seq <- seq(min(countValue), max(countValue), 1000)\r\n  number.llconf1 <- (p.fem - zLow * sqrt((p.fem*(1-p.fem)) / (number.seq)))*mult\r\n  number.ulconf1 <- (p.fem + zLow * sqrt((p.fem*(1-p.fem)) / (number.seq)))*mult\r\n  number.llconf2 <- (p.fem - zUp * sqrt((p.fem*(1-p.fem)) / (number.seq)))*mult\r\n  number.ulconf2 <- (p.fem + zUp * sqrt((p.fem*(1-p.fem)) / (number.seq)))*mult\r\n  \r\n  yAxis = p*mult\r\n  p.fem = p.fem*mult\r\n  \r\n  dfCI <- data.frame(number.llconf1, number.ulconf1, number.llconf2, number.ulconf2, number.seq, p.fem)\r\n  \r\n  #tweak the limits of the y-axis\r\n  limsY = NiceLimitsAxis(axisData = yAxis, baseline = p.fem)\r\n  \r\n  xLabText = cutStr2Show( namesDS[1], strCex = sizeLabel/6, isH = TRUE, partAvailable = 0.85)\r\n  yLabText = cutStr2Show( paste(entryWordLabelY, namesDS[2], sep =\"\"), strCex = sizeLabel/6, isH = FALSE, partAvailable = 0.85)\r\n  \r\n  ## draw plot\r\n  if(sparsify)\r\n    drawPoints = SparsifyScatter(dataset)# remove points from dense regions\r\n  else\r\n    drawPoints = SparsifyScatter(dataset,minMaxPoints = c(Inf,Inf))\r\n  \r\n  fp <- ggplot(aes(x = countValue[drawPoints], y = yAxis[drawPoints]), data = df[drawPoints,]) \r\n  fp <- fp + geom_point(shape = 19, colour = alpha(pointsCol,transparency), size = pointCex*2 ) \r\n  \r\n  fp <- fp + geom_line(aes(x = number.seq, y = number.llconf1),linetype = 1, colour = \"green\",data = dfCI) \r\n  fp <- fp + geom_line(aes(x = number.seq, y = number.ulconf1),linetype = 1, colour = \"green\", data = dfCI) \r\n  \r\n  fp <- fp + geom_line(aes(x = number.seq, y = number.llconf2),linetype = 2, colour = \"red\",data = dfCI) \r\n  fp <- fp + geom_line(aes(x = number.seq, y = number.ulconf2), linetype = 2, colour = \"red\",data = dfCI) \r\n  \r\n  fp <- fp + geom_hline(aes(yintercept = p.fem), data = dfCI, colour = lineColor, linetype = 4)\r\n  \r\n  if(scaleYformat %in% c(\"none\"))\r\n    fp <- fp + scale_y_continuous(limits =limsY)\r\n  \r\n  if(scaleYformat %in% c(\"comma\"))\r\n    fp <- fp + scale_y_continuous(limits =limsY, labels = comma)\r\n  \r\n  if(scaleYformat %in% c(\"scientific\"))\r\n    fp <- fp + scale_y_continuous(limits =limsY, labels = scientific)\r\n  \r\n  if(scaleXformat %in% c(\"comma\"))\r\n    fp <- fp + scale_x_continuous(labels = comma)\r\n  \r\n  if(scaleXformat %in% c(\"dollar\"))\r\n    fp <- fp + scale_x_continuous(labels = dollar)\r\n  \r\n  if(scaleXformat %in% c(\"scientific\"))\r\n    fp <- fp + scale_x_continuous(labels = scientific)\r\n  \r\n  fp <- fp + xlab(xLabText) + ylab(yLabText) + theme_bw()\r\n  \r\n  if(verticalPlot)\r\n    fp <- fp +  coord_flip()\r\n  \r\n}else{# empty plot \r\n  fp <- ggplot()\r\n}\r\n\r\n#add warning as title\r\nfp = fp + labs (title = pbiWarning, caption = NULL) + theme_bw() + \r\n  theme(plot.title  = element_text(hjust = 0.5, size = sizeWarn), \r\n        axis.title=element_text(size =  sizeLabel, colour = colLabel),\r\n        axis.text=element_text(size =  sizeTicks),\r\n        panel.border = element_blank(), axis.line = element_line())\r\n\r\nif(!validToPlot) # remove axes from empty plot \r\n  fp = fp + theme(axis.line = element_blank())\r\n\r\nprint(fp)\r\n"}}}],"objects":{"rcv_script":{"properties":{"provider":{"type":{"text":true}},"source":{"type":{"scripting":{"source":true}}}}}},"suppressDefaultTitle":true},"dependencies":{"cranPackages":[{"name":"ggplot2","displayName":"GG Plot 2","url":"https://cran.r-project.org/web/packages/ggplot2/index.html"},{"name":"scales","displayName":"scales: Scale Functions for Visualization","url":"https://cran.r-project.org/web/packages/scales/index.html"}]},"stringResources":{},"content":{"js":"var powerbi;!function(e){!function(e){!function(e){!function(e){!function(e){function t(e,t,n){void 0===e&&(e=[]);var r=e;return i(r),t&&(r.identityFields=t),n&&(r.source=n),r}function i(e,t){e.grouped=t?function(){return t}:function(){return n(e)}}function n(e){for(var t,i=[],n=0,r=e.length;n<r;n++){var a=e[n];if(!t||t.identity!==a.identity){if(t={values:[]},a.identity){t.identity=a.identity;var o=a.source;void 0!==o.groupName?t.name=o.groupName:o.displayName&&(t.name=o.displayName)}i.push(t)}t.values.push(a)}return i}e.createValueColumns=t,e.setGrouped=i,e.groupValues=n}(e.DataViewTransform||(e.DataViewTransform={}))}(e.dataview||(e.dataview={}))}(e.utils||(e.utils={}))}(e.extensibility||(e.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(e){!function(e){!function(e){!function(e){!function(e){function t(e,t){if(!e||!e.length)return-1;var i=e[0];if(i.values&&i.values.length>0)for(var r=0,a=i.values.length;r<a;++r){var o=i.values[r];if(o&&o.source&&n(o.source,t))return r}return-1}function i(e,t){if(e&&e.length)for(var i=0,r=e.length;i<r;i++)if(n(e[i].source,t))return i;return-1}function n(e,t){var i=e.roles;return i&&i[t]}function r(e,t){return null!=e&&null!=e.metadata&&e.metadata.columns&&e.metadata.columns.some(function(e){return e.roles&&void 0!==e.roles[t]})}function a(e,t){return e&&e.source&&e.source.roles&&!0===e.source.roles[t]}e.getMeasureIndexOfRole=t,e.getCategoryIndexOfRole=i,e.hasRole=n,e.hasRoleInDataView=r,e.hasRoleInValueColumn=a}(e.DataRoleHelper||(e.DataRoleHelper={}))}(e.dataview||(e.dataview={}))}(e.utils||(e.utils={}))}(e.extensibility||(e.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(e){!function(e){!function(e){!function(e){!function(e){function t(e,t,i){if(!e)return i;var n=e[t];return void 0===n?i:n}function i(e,i,n){var r=t(e,i);return r&&r.solid?r.solid.color:n}e.getValue=t,e.getFillColorByPropertyName=i}(e.DataViewObject||(e.DataViewObject={}))}(e.dataview||(e.dataview={}))}(e.utils||(e.utils={}))}(e.extensibility||(e.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(e){!function(e){!function(e){!function(e){!function(t){function i(t,i,n){return t?e.DataViewObject.getValue(t[i.objectName],i.propertyName,n):n}function n(e,t,i){return e&&e[t]?e[t]:i}function r(e,t,n){var r=i(e,t);return r&&r.solid?r.solid.color:n}function a(e,t,n){var r=i(e,t,n);return r&&r.solid?r.solid.color:void 0===r||null===r||\"object\"==typeof r&&!r.solid?n:r}t.getValue=i,t.getObject=n,t.getFillColor=r,t.getCommonValue=a}(e.DataViewObjects||(e.DataViewObjects={}))}(e.dataview||(e.dataview={}))}(e.utils||(e.utils={}))}(e.extensibility||(e.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(e){!function(t){!function(t){!function(t){var i=e.extensibility.utils.dataview.DataRoleHelper;!function(e){function t(e,t,n){if(e.categories&&e.categories.length>0){var r=e.categories[0];return r.source&&i.hasRole(r.source,t)&&i.hasRole(r.source,n)}return!1}function n(e){return void 0!==e.groupName?e.groupName:e.queryName}function r(e){var t=o(e);return null!=t&&!0===t.imageUrl}function a(e){var t=o(e);return null!=t&&!0===t.webUrl}function o(e){return e&&e.type&&e.type.misc}function u(e){return!!(e&&e.metadata&&e.metadata.columns&&e.metadata.columns.length)&&e.metadata.columns.some(function(e){return!0===r(e)})}e.categoryIsAlsoSeriesRole=t,e.getSeriesName=n,e.isImageUrlColumn=r,e.isWebUrlColumn=a,e.getMiscellaneousTypeDescriptor=o,e.hasImageUrlColumn=u}(t.converterHelper||(t.converterHelper={}))}(t.dataview||(t.dataview={}))}(t.utils||(t.utils={}))}(e.extensibility||(e.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(e){!function(e){!function(e){!function(e){var t=function(){function t(){}return t.getDefault=function(){return new this},t.createPropertyIdentifier=function(e,t){return{objectName:e,propertyName:t}},t.parse=function(t){var i,n=this.getDefault();if(!t||!t.metadata||!t.metadata.objects)return n;i=n.getProperties();for(var r in i)for(var a in i[r]){var o=n[r][a];n[r][a]=e.DataViewObjects.getCommonValue(t.metadata.objects,i[r][a],o)}return n},t.isPropertyEnumerable=function(e){return!t.InnumerablePropertyPrefix.test(e)},t.enumerateObjectInstances=function(e,t){var i=e&&e[t.objectName];if(!i)return[];var n={objectName:t.objectName,selector:null,properties:{}};for(var r in i)i.hasOwnProperty(r)&&(n.properties[r]=i[r]);return{instances:[n]}},t.prototype.getProperties=function(){var e=this,i={};return Object.keys(this).forEach(function(n){if(t.isPropertyEnumerable(n)){var r=Object.keys(e[n]);i[n]={},r.forEach(function(e){t.isPropertyEnumerable(n)&&(i[n][e]=t.createPropertyIdentifier(n,e))})}}),i},t}();t.InnumerablePropertyPrefix=/^_/,e.DataViewObjectsParser=t}(e.dataview||(e.dataview={}))}(e.utils||(e.utils={}))}(e.extensibility||(e.extensibility={}))}(powerbi||(powerbi={}));var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},powerbi;!function(e){!function(t){!function(t){!function(t){\"use strict\";var i=e.extensibility.utils.dataview.DataViewObjectsParser,n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rcv_script=new r,t}return __extends(t,e),t}(i);t.VisualSettings=n;var r=function(){function e(){}return e}();t.rcv_scriptSettings=r}(t.funnelRvisualVer02||(t.funnelRvisualVer02={}))}(t.visual||(t.visual={}))}(e.extensibility||(e.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(e){!function(e){!function(e){!function(e){\"use strict\";var t=function(){function t(e){this.imageDiv=document.createElement(\"div\"),this.imageDiv.className=\"rcv_autoScaleImageContainer\",this.imageElement=document.createElement(\"img\"),this.imageElement.className=\"rcv_autoScaleImage\",this.imageDiv.appendChild(this.imageElement),e.element.appendChild(this.imageDiv)}return t.prototype.update=function(e){if(e&&e.type&&e.viewport&&e.dataViews&&0!==e.dataViews.length&&e.dataViews[0]){var i=e.dataViews[0];this.settings=t.parseSettings(i);var n=null;i.scriptResult&&i.scriptResult.payloadBase64&&(n=\"data:image/png;base64,\"+i.scriptResult.payloadBase64),this.imageElement.src=n||null,this.onResizing(e.viewport)}},t.prototype.onResizing=function(e){this.imageDiv.style.height=e.height+\"px\",this.imageDiv.style.width=e.width+\"px\"},t.parseSettings=function(t){return e.VisualSettings.parse(t)},t.prototype.enumerateObjectInstances=function(t){return e.VisualSettings.enumerateObjectInstances(this.settings||e.VisualSettings.getDefault(),t)},t}();e.Visual=t}(e.funnelRvisualVer02||(e.funnelRvisualVer02={}))}(e.visual||(e.visual={}))}(e.extensibility||(e.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(e){!function(t){!function(t){t.funnelRvisualVer02={name:\"funnelRvisualVer02\",displayName:\"funnelRvisualVer02\",class:\"Visual\",version:\"1.0.2\",apiVersion:\"1.7.0\",create:function(t){return new e.extensibility.visual.funnelRvisualVer02.Visual(t)},custom:!0}}(t.plugins||(t.plugins={}))}(e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));","css":".visual-funnelRvisualVer02 .rcv_autoScaleImageContainer{position:relative}.visual-funnelRvisualVer02 .rcv_autoScaleImageContainer .rcv_autoScaleImage{max-width:100%;max-height:100%;position:absolute;top:50%;left:50%;transform:translateY(-50%) translateX(-50%);-webkit-transform:translateY(-50%) translateX(-50%)}","iconBase64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2RpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpBOEJGMzkxN0NBRDNFMDExQTcxQ0JFODI3ODBCQUE5RSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo3NEY1QjA1NUQ0OTAxMUUwQTgxREI2NjMxMkNEMUNEMyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo3NEY1QjA1NEQ0OTAxMUUwQTgxREI2NjMxMkNEMUNEMyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IFdpbmRvd3MiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5Mjk5RDU1ODBGRDRFMDExQTcxQ0JFODI3ODBCQUE5RSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpBOEJGMzkxN0NBRDNFMDExQTcxQ0JFODI3ODBCQUE5RSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PpDoNX0AAAI3SURBVHjarJRLSFVRFIY9t7SiRDGLoEEPCRJRaCSYkxCiFCXCF+LIMExQLkilgumgwkbdBuWDRC2EomhURCOjgagkXEgKLUKhidobM6H0+i34rxyPnuvEA5/rXPda/1l7739vJxKJxG3ls93+hEKhTILxJhgMftmsiPxdhHw4CfepeR8dCyjWwwB0kZy3iVgCoQ2ewnmXxhrBD7Cgr/ZQVA17fDRPw2UYhzK6G99IsBse6/0QNME+H8FT4EA/YiPqOgA1q4IMzBNuw6iKjkCpj+Av+AdnEEmD3bxfhzvuDk30HaEaLsEkXCO53rN+Bwg5qsvTuj/TjGYtx9nINhRmEx7AYWiFW7AXOuEcbPOUvIZ2mnrl+PkQUbNEh4QHNKUSDdsSBWEOlmxTEfvs26FL9Khe211if6Acgee+xo7xzMgBxfq9qPe3fgWBGN2lEnqtG9nExM7CV3jp3bDos2bKJB0nHFRxAxRpA/5CIXyHh5ABv6GZqd9dJ6iz2SjbxMMypGhJFtTlNzu3kK7xgDxpove8U66FK2A+s6nul5gVVMEL+Ak7lG/T+g9JcIOGar2CRUoogxMwpP/bLTJMB9bRhDbkk5bBUU0y3ES0xS04CBfN9RSHiY90vJK0BHaSzG9h2eejS3RJeVfdtrGzuGyd8CX7Yq6ExuCH63jaVMPkFOv6OibB6DKs2+VEQp+WYBoqERn2sVWWRNN0YurIfeL14U6YkpkLYCSG6e0yqdCxvKBLIm5FgAEAV0nKuwMYRUsAAAAASUVORK5CYII="}}